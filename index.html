<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Values Discovery Survey</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .main-content {
            padding: 40px;
        }

        .progress-container {
            margin-bottom: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .step {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .instructions {
            background: #f8f9ff;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .instructions h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .selection-notice {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-weight: 600;
        }

        .selection-counter {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            text-align: center;
            margin: 20px 0;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .student-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-group input {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .values-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .value-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .value-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .value-card.selected {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
            transform: scale(1.02);
        }

        .value-card.custom {
            border-color: #28a745;
        }

        .value-card.custom.selected {
            background: linear-gradient(135deg, #28a745, #20c997);
            border-color: #28a745;
        }

        .value-card h3 {
            font-size: 1.2rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .value-card p {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.4;
        }

        .custom-value-section {
            margin-top: 30px;
            background: #f8f9ff;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .custom-input-row {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: end;
            margin-bottom: 20px;
        }

        .custom-values-display {
            margin-top: 20px;
        }

        .custom-value-tag {
            display: inline-block;
            background: white;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 10px 15px;
            margin: 5px;
            position: relative;
        }

        .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            line-height: 1;
        }

        .sorting-area {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-top: 30px;
        }

        .rank-column {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
            min-height: 200px;
            border: 2px dashed #ddd;
            text-align: center;
            transition: all 0.3s ease;
        }

        .rank-column.drag-over {
            border-color: #667eea;
            background: #e8f0fe;
            transform: scale(1.02);
        }

        .rank-number {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            line-height: 40px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .sorted-value {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            cursor: move;
            transition: all 0.3s ease;
        }

        .sorted-value.custom {
            border-color: #28a745;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .step-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #e9ecef;
        }

        .results {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
        }

        .top-values {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-bottom: 40px;
        }

        .top-value {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .top-value::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .top-value.custom::before {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .value-rank {
            font-size: 3rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .modal {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalPop 0.3s ease-out;
        }

        .modal h3 {
            color: #ff6b6b;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .modal p {
            color: #555;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .modal button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
        }

        @keyframes modalPop {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @media (max-width: 768px) {
            .values-grid { grid-template-columns: 1fr; }
            .sorting-area { grid-template-columns: 1fr; }
            .top-values { grid-template-columns: 1fr; }
            .custom-input-row { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Values Discovery Survey</h1>
            <p>Discover your core values through this interactive assessment. Understanding your values helps guide important life and career decisions.</p>
        </div>

        <div class="main-content">
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <!-- Step 1: Student Information -->
            <div class="step active" id="step1">
                <div class="instructions">
                    <h2>Student Information</h2>
                    <p>Please provide your information to personalize your results.</p>
                </div>
                
                <div class="student-info">
                    <div class="form-group">
                        <label for="studentName">Full Name</label>
                        <input type="text" id="studentName" placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label for="surveyDate">Date</label>
                        <input type="date" id="surveyDate">
                    </div>
                </div>

                <div class="step-navigation">
                    <div></div>
                    <button class="btn" onclick="nextStep()">Begin Survey</button>
                </div>
            </div>

            <!-- Step 2: Instructions -->
            <div class="step" id="step2">
                <div class="instructions">
                    <h2>How This Survey Works</h2>
                    <ol>
                        <li><strong>Choose Your Values:</strong> You'll select up to 6 values from our comprehensive list.</li>
                        <li><strong>Add Custom Values:</strong> You can create your own custom values if something important to you isn't listed.</li>
                        <li><strong>Rank Your Top 3:</strong> From your selected values, you'll prioritize your top 3 in order of importance.</li>
                        <li><strong>Get Your Results:</strong> Receive a personalized report of your core values that you can save as a PDF.</li>
                    </ol>
                </div>

                <div class="step-navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn" onclick="nextStep()">Start Exploring Values</button>
                </div>
            </div>

            <!-- Step 3: Value Selection -->
            <div class="step" id="step3">
                <div class="instructions">
                    <h2>Step 1: Choose Your Values</h2>
                    <p>Click on up to 6 values that resonate most with you. Trust your instincts and choose values that feel important to who you are.</p>
                    <div class="selection-notice">
                        📌 <strong>Selection Limit:</strong> You can select a maximum of 6 values. If you want to choose additional values, you'll need to deselect some of your current choices first.
                    </div>
                </div>

                <div class="selection-counter" id="selectionCounter">🎯 Select up to 6 values that resonate with you</div>

                <div class="values-grid" id="valuesGrid"></div>

                <div class="custom-value-section">
                    <h3>Add Your Own Value</h3>
                    <p>Don't see something that's important to you? Create your own custom value below.</p>
                    
                    <div class="custom-input-row">
                        <div class="form-group">
                            <label for="customValueName">Value Name</label>
                            <input type="text" id="customValueName" placeholder="e.g., Innovation" maxlength="20">
                        </div>
                        <div class="form-group">
                            <label for="customValueDescription">Description</label>
                            <input type="text" id="customValueDescription" placeholder="What this value means to you" maxlength="80">
                        </div>
                        <button class="btn" onclick="addCustomValue()" style="margin: 0;">Add Value</button>
                    </div>
                    
                    <div class="custom-values-display" id="customValuesDisplay"></div>
                </div>

                <div class="step-navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn" onclick="nextStep()" id="continueBtn" disabled>Continue with Selected Values</button>
                </div>
            </div>

            <!-- Step 4: Ranking -->
            <div class="step" id="step4">
                <div class="instructions">
                    <h2>Step 2: Rank Your Top 3 Values</h2>
                    <p>Now it's time to prioritize what matters most to you.</p>
                    
                    <div style="background: #e3f2fd; border: 3px solid #2196f3; border-radius: 15px; padding: 25px; margin: 20px 0; text-align: center;">
                        <h3 style="color: #1976d2; margin-bottom: 15px; font-size: 1.4rem;">📱 How to Rank Your Values:</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                            <div style="background: white; padding: 15px; border-radius: 10px; border: 2px solid #2196f3;">
                                <div style="font-size: 2rem; margin-bottom: 10px;">👆</div>
                                <strong>Step 1:</strong><br>
                                Click and hold a value card below
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 10px; border: 2px solid #2196f3;">
                                <div style="font-size: 2rem; margin-bottom: 10px;">🫴</div>
                                <strong>Step 2:</strong><br>
                                Drag it to a ranking box
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 10px; border: 2px solid #2196f3;">
                                <div style="font-size: 2rem; margin-bottom: 10px;">🎯</div>
                                <strong>Step 3:</strong><br>
                                Drop it in your chosen rank
                            </div>
                        </div>
                        <p style="margin-top: 20px; font-weight: 600; color: #1976d2;">
                            Choose your 3 most important values and place them in order of priority!
                        </p>
                    </div>
                </div>

                <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 10px; padding: 15px; margin-bottom: 20px; text-align: center;">
                    <strong>💡 Tip:</strong> Think about which values would guide your most important life decisions. What principles would you never want to compromise?
                </div>

                <h3 style="color: #2c3e50; margin-bottom: 20px; text-align: center;">Your Selected Values - Drag These to Rank Them:</h3>
                <div class="values-grid" id="rankingPool"></div>

                <h3 style="color: #2c3e50; margin: 30px 0 20px; text-align: center;">Drop Your Values Here to Rank Them:</h3>
                <div class="sorting-area">
                    <div class="rank-column" data-rank="1">
                        <div class="rank-number">1</div>
                        <h3>Most Important</h3>
                        <p>Your highest priority value</p>
                        <div style="margin-top: 15px; font-size: 0.9rem; color: #666; font-style: italic;">
                            Drop a value here
                        </div>
                    </div>
                    <div class="rank-column" data-rank="2">
                        <div class="rank-number">2</div>
                        <h3>Second Most Important</h3>
                        <p>Your second priority value</p>
                        <div style="margin-top: 15px; font-size: 0.9rem; color: #666; font-style: italic;">
                            Drop a value here
                        </div>
                    </div>
                    <div class="rank-column" data-rank="3">
                        <div class="rank-number">3</div>
                        <h3>Third Most Important</h3>
                        <p>Your third priority value</p>
                        <div style="margin-top: 15px; font-size: 0.9rem; color: #666; font-style: italic;">
                            Drop a value here
                        </div>
                    </div>
                </div>

                <div class="step-navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn" onclick="showResults()" id="resultsBtn" disabled>View My Results</button>
                </div>
            </div>

            <!-- Step 5: Results -->
            <div class="step" id="step5">
                <div class="results">
                    <h2>Your Top 3 Values</h2>
                    <p style="margin-bottom: 30px; font-size: 1.1rem; color: #666;">These are your core values - the principles that guide your most important decisions.</p>
                    
                    <div class="top-values" id="topValues"></div>

                    <div style="margin-top: 40px;">
                        <button class="btn" onclick="generatePDF()">Generate PDF Report</button>
                        <button class="btn btn-secondary" onclick="resetSurvey()">Take Survey Again</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // All 91 values
        const values = [
            { name: "Achievement", description: "Accomplishing goals, succeeding, and reaching your potential" },
            { name: "Adaptability", description: "Being flexible and adjusting well to changing circumstances" },
            { name: "Adventure", description: "Seeking new experiences, taking risks, and embracing the unknown" },
            { name: "Authenticity", description: "Being true to yourself and living according to your genuine beliefs" },
            { name: "Authority", description: "Having influence, control, and the ability to lead others" },
            { name: "Autonomy", description: "Independence, self-reliance, and freedom to make your own choices" },
            { name: "Balance", description: "Maintaining harmony between different aspects of life" },
            { name: "Beauty", description: "Appreciating and creating aesthetic experiences and environments" },
            { name: "Belonging", description: "Feeling accepted and connected within groups and communities" },
            { name: "Boldness", description: "Having courage to take risks and stand up for your beliefs" },
            { name: "Challenge", description: "Embracing difficult tasks and pushing beyond comfort zones" },
            { name: "Citizenship", description: "Contributing to society and fulfilling civic responsibilities" },
            { name: "Community", description: "Belonging to and contributing to a group or society" },
            { name: "Compassion", description: "Showing empathy, kindness, and care for others' wellbeing" },
            { name: "Competency", description: "Developing skills and expertise in areas that matter to you" },
            { name: "Connection", description: "Building meaningful bonds and relationships with others" },
            { name: "Contribution", description: "Making a positive difference in the lives of others" },
            { name: "Courage", description: "Facing fears and challenges with bravery and determination" },
            { name: "Creativity", description: "Expressing imagination, innovation, and original thinking" },
            { name: "Curiosity", description: "Having a strong desire to learn and explore new ideas" },
            { name: "Determination", description: "Persistence and resolve in pursuing goals despite obstacles" },
            { name: "Dignity", description: "Maintaining self-respect and treating others with honor" },
            { name: "Diversity", description: "Valuing and embracing differences in people and perspectives" },
            { name: "Efficiency", description: "Accomplishing tasks with minimal waste of time and resources" },
            { name: "Equality", description: "Believing in fair treatment and equal opportunities for all" },
            { name: "Excellence", description: "Striving for the highest quality and continuous improvement" },
            { name: "Faith", description: "Spiritual beliefs, trust in higher purpose, and religious practice" },
            { name: "Fame", description: "Being widely known and recognized for your achievements" },
            { name: "Family", description: "Prioritizing relationships with loved ones and family bonds" },
            { name: "Fairness", description: "Treating people justly and without bias or favoritism" },
            { name: "Financial Stability", description: "Having secure financial resources and economic security" },
            { name: "Freedom", description: "Liberty, choice, and the absence of unnecessary restrictions" },
            { name: "Friendships", description: "Building and maintaining meaningful relationships with peers" },
            { name: "Fun", description: "Enjoying life, humor, playfulness, and recreational activities" },
            { name: "Generosity", description: "Giving freely of your time, resources, and kindness to others" },
            { name: "Grace", description: "Showing elegance, kindness, and forgiveness in interactions" },
            { name: "Gratitude", description: "Appreciating and being thankful for what you have" },
            { name: "Growth", description: "Continuous learning, personal development, and self-improvement" },
            { name: "Happiness", description: "Pursuing joy, contentment, and positive emotional well-being" },
            { name: "Health", description: "Physical, mental, and emotional wellbeing and vitality" },
            { name: "Home", description: "Creating a safe, comfortable, and nurturing living environment" },
            { name: "Honesty", description: "Truthfulness, integrity, and transparent communication" },
            { name: "Humility", description: "Being modest and not thinking you are better than others" },
            { name: "Humor", description: "Finding and creating laughter, joy, and lightness in life" },
            { name: "Influence", description: "Having the power to affect change and inspire others" },
            { name: "Initiative", description: "Taking proactive steps and being self-motivated to act" },
            { name: "Integrity", description: "Acting in accordance with moral principles and values" },
            { name: "Intimacy", description: "Building close, personal, and meaningful relationships" },
            { name: "Joy", description: "Experiencing and spreading happiness, delight, and celebration" },
            { name: "Justice", description: "Fairness, equality, and standing up for what's right" },
            { name: "Kindness", description: "Being considerate, helpful, and caring toward others" },
            { name: "Knowledge", description: "Learning, understanding, and the pursuit of wisdom" },
            { name: "Leadership", description: "Guiding others, taking initiative, and making important decisions" },
            { name: "Learning", description: "Continuously acquiring new knowledge and skills" },
            { name: "Leisure", description: "Enjoying relaxation, hobbies, and recreational activities" },
            { name: "Love", description: "Giving and receiving deep affection and emotional connection" },
            { name: "Loyalty", description: "Being faithful and committed to people and principles" },
            { name: "Meaningful Work", description: "Engaging in work that has purpose and personal significance" },
            { name: "Nature", description: "Connecting with and protecting the natural environment" },
            { name: "Openness", description: "Being receptive to new ideas, experiences, and perspectives" },
            { name: "Optimism", description: "Maintaining a positive outlook and hope for the future" },
            { name: "Order", description: "Organizing life and environment in a structured, systematic way" },
            { name: "Parenting", description: "Nurturing, guiding, and supporting the development of children" },
            { name: "Patience", description: "Remaining calm and tolerant when facing delays or difficulties" },
            { name: "Peace", description: "Seeking harmony, tranquility, and resolution of conflicts" },
            { name: "Perseverance", description: "Continuing efforts despite difficulties or setbacks" },
            { name: "Pleasure", description: "Enjoying life's pleasures and seeking enjoyable experiences" },
            { name: "Poise", description: "Maintaining composure, dignity, and grace under pressure" },
            { name: "Popularity", description: "Being well-liked and accepted by many people" },
            { name: "Power", description: "Having control, influence, and authority over situations" },
            { name: "Pride", description: "Taking satisfaction in your accomplishments and identity" },
            { name: "Recognition", description: "Being acknowledged, appreciated, and respected by others" },
            { name: "Reliability", description: "Being dependable and trustworthy in commitments and actions" },
            { name: "Reputation", description: "Maintaining a good standing and respect in your community" },
            { name: "Respect", description: "Treating others with consideration and earning their esteem" },
            { name: "Responsibility", description: "Being accountable for your actions and obligations" },
            { name: "Security", description: "Safety, stability, and protection from harm or uncertainty" },
            { name: "Self-Discipline", description: "Having control over your actions, emotions, and desires" },
            { name: "Self-Respect", description: "Valuing yourself and maintaining personal dignity" },
            { name: "Service", description: "Helping others, contributing to society, and making a difference" },
            { name: "Spirituality", description: "Connection to something greater than yourself and inner peace" },
            { name: "Stability", description: "Consistency, predictability, and reliable foundations in life" },
            { name: "Status", description: "Achieving a position of prestige and social standing" },
            { name: "Stewardship", description: "Taking care of resources and responsibilities for future generations" },
            { name: "Success", description: "Achieving goals and reaching desired outcomes" },
            { name: "Teamwork", description: "Collaborating effectively with others toward common goals" },
            { name: "Travel", description: "Exploring new places, cultures, and expanding horizons" },
            { name: "Truth", description: "Seeking and upholding what is honest, genuine, and real" },
            { name: "Trustworthiness", description: "Being reliable and deserving of others' confidence" },
            { name: "Understanding", description: "Seeking to comprehend others and complex situations deeply" },
            { name: "Uniqueness", description: "Embracing what makes you distinct and individual" },
            { name: "Vision", description: "Having a clear picture of future possibilities and goals" },
            { name: "Vulnerability", description: "Being open about your feelings and authentic in relationships" },
            { name: "Wealth", description: "Accumulating financial resources and material prosperity" },
            { name: "Wisdom", description: "Applying knowledge and experience to make sound decisions" }
        ];

        // Clean global variables
        let currentStep = 1;
        let selectedValues = [];
        let customValues = [];
        let rankedValues = { 1: null, 2: null, 3: null };
        let studentInfo = {};

        // Initialize survey
        function initSurvey() {
            document.getElementById('surveyDate').valueAsDate = new Date();
            populateValuesGrid();
            updateProgress();
            updateSelectionCounter();
        }

        // Simple modal system
        function showModal(title, message) {
            const existingModal = document.querySelector('.modal-overlay');
            if (existingModal) existingModal.remove();

            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';
            overlay.innerHTML = `
                <div class="modal">
                    <h3>${title}</h3>
                    <p>${message}</p>
                    <button onclick="closeModal()">Got it!</button>
                </div>
            `;

            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) closeModal();
            });

            document.body.appendChild(overlay);
            setTimeout(closeModal, 5000);
        }

        function closeModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) modal.remove();
        }

        // Populate values grid
        function populateValuesGrid() {
            const grid = document.getElementById('valuesGrid');
            grid.innerHTML = '';
            
            const allValues = [...values, ...customValues];
            const shuffledValues = allValues.sort(() => Math.random() - 0.5);
            
            shuffledValues.forEach(value => {
                const card = document.createElement('div');
                card.className = 'value-card';
                
                if (value.isCustom) card.classList.add('custom');
                
                const isSelected = selectedValues.some(v => 
                    v.name === value.name && Boolean(v.isCustom) === Boolean(value.isCustom)
                );
                
                if (isSelected) card.classList.add('selected');
                
                card.innerHTML = `
                    <h3>${value.name}${value.isCustom ? ' ✨' : ''}</h3>
                    <p>${value.description}</p>
                `;
                
                card.onclick = () => toggleValue(card, value);
                grid.appendChild(card);
            });
        }

        // Toggle value selection with 6-value limit
        function toggleValue(card, value) {
            const isSelected = selectedValues.some(v => 
                v.name === value.name && Boolean(v.isCustom) === Boolean(value.isCustom)
            );
            
            if (isSelected) {
                selectedValues = selectedValues.filter(v => 
                    !(v.name === value.name && Boolean(v.isCustom) === Boolean(value.isCustom))
                );
                card.classList.remove('selected');
            } else {
                if (selectedValues.length >= 6) {
                    showModal(
                        '🚫 Selection Limit Reached',
                        'You can only select up to 6 values in this step. Please deselect a value first if you\'d like to choose a different one.'
                    );
                    
                    card.style.border = '3px solid #ff6b6b';
                    card.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        card.style.border = '';
                        card.style.transform = '';
                    }, 1000);
                    
                    return;
                }
                
                selectedValues.push(value);
                card.classList.add('selected');
            }
            
            updateSelectionCounter();
            updateButtonStates();
        }

        // Add custom value
        function addCustomValue() {
            const nameInput = document.getElementById('customValueName');
            const descInput = document.getElementById('customValueDescription');
            
            const name = nameInput.value.trim();
            const description = descInput.value.trim();
            
            if (!name || !description) {
                showModal(⚠️ Missing Information', 'Please provide both a name and description for your custom value.');
                return;
            }
            
            if (selectedValues.length >= 6) {
                showModal('🚫 Selection Limit Reached', 'You have already selected 6 values. Please deselect one before adding a custom value.');
                return;
            }
            
            const allValues = [...values, ...customValues];
            if (allValues.some(v => v.name.toLowerCase() === name.toLowerCase())) {
                showModal('🔄 Duplicate Value', 'A value with this name already exists. Please choose a different name.');
                return;
            }
            
            const customValue = { name, description, isCustom: true };
            
            customValues.push(customValue);
            selectedValues.push(customValue);
            
            nameInput.value = '';
            descInput.value = '';
            
            displayCustomValues();
            populateValuesGrid();
            updateSelectionCounter();
            updateButtonStates();
            
            showModal('✨ Custom Value Added!', `"${name}" has been created and automatically selected for you.`);
        }

        // Display custom values
        function displayCustomValues() {
            const display = document.getElementById('customValuesDisplay');
            
            if (customValues.length === 0) {
                display.innerHTML = '';
                return;
            }
            
            display.innerHTML = '<h4 style="color: #2c3e50; margin-bottom: 15px;">Your Custom Values:</h4>';
            
            customValues.forEach((value, index) => {
                const tag = document.createElement('div');
                tag.className = 'custom-value-tag';
                tag.innerHTML = `
                    <strong>${value.name} ✨</strong><br>
                    <small style="color: #666;">${value.description}</small>
                    <button class="remove-btn" onclick="removeCustomValue(${index})">×</button>
                `;
                display.appendChild(tag);
            });
        }

        // Remove custom value
        function removeCustomValue(index) {
            const valueToRemove = customValues[index];
            
            customValues.splice(index, 1);
            selectedValues = selectedValues.filter(v => !(v.isCustom && v.name === valueToRemove.name));
            
            displayCustomValues();
            populateValuesGrid();
            updateSelectionCounter();
            updateButtonStates();
        }

        // Update selection counter
        function updateSelectionCounter() {
            const counter = document.getElementById('selectionCounter');
            const remaining = 6 - selectedValues.length;
            
            if (selectedValues.length === 0) {
                counter.innerHTML = '🎯 Select up to 6 values that resonate with you';
            } else if (remaining > 0) {
                counter.innerHTML = `✅ ${selectedValues.length} selected • You can select ${remaining} more value${remaining === 1 ? '' : 's'}`;
            } else {
                counter.innerHTML = '🎉 Perfect! You\'ve selected 6 values. Ready to move forward!';
            }
        }

        // Update button states
        function updateButtonStates() {
            const continueBtn = document.getElementById('continueBtn');
            if (continueBtn) {
                continueBtn.disabled = selectedValues.length === 0;
                continueBtn.textContent = selectedValues.length > 0 
                    ? `Continue with ${selectedValues.length} Selected Value${selectedValues.length === 1 ? '' : 's'}`
                    : 'Continue with Selected Values';
            }
            
            const resultsBtn = document.getElementById('resultsBtn');
            if (resultsBtn) {
                const complete = rankedValues[1] && rankedValues[2] && rankedValues[3];
                resultsBtn.disabled = !complete;
            }
        }

        // Navigation functions
        function nextStep() {
            if (currentStep === 1) {
                studentInfo = {
                    name: document.getElementById('studentName').value,
                    date: document.getElementById('surveyDate').value
                };
            } else if (currentStep === 3) {
                if (selectedValues.length === 0) {
                    showModal('⚠️ No Values Selected', 'Please select at least one value before continuing.');
                    return;
                }
                setupRankingStep();
            }
            
            document.getElementById(`step${currentStep}`).classList.remove('active');
            currentStep++;
            document.getElementById(`step${currentStep}`).classList.add('active');
            updateProgress();
        }

        function prevStep() {
            document.getElementById(`step${currentStep}`).classList.remove('active');
            currentStep--;
            document.getElementById(`step${currentStep}`).classList.add('active');
            updateProgress();
        }

        // Setup ranking step
        function setupRankingStep() {
            const pool = document.getElementById('rankingPool');
            pool.innerHTML = '';
            
            selectedValues.forEach(value => {
                const card = document.createElement('div');
                card.className = 'value-card';
                card.draggable = true;
                
                if (value.isCustom) card.classList.add('custom');
                
                card.innerHTML = `
                    <h3>${value.name}${value.isCustom ? ' ✨' : ''}</h3>
                    <p>${value.description}</p>
                `;
                
                card.ondragstart = (e) => {
                    e.dataTransfer.setData('text/plain', JSON.stringify(value));
                };
                
                pool.appendChild(card);
            });
            
            setupDragAndDrop();
        }

        // Setup drag and drop
        function setupDragAndDrop() {
            document.querySelectorAll('.rank-column').forEach(column => {
                column.ondragover = (e) => {
                    e.preventDefault();
                    column.classList.add('drag-over');
                };
                
                column.ondragleave = () => {
                    column.classList.remove('drag-over');
                };
                
                column.ondrop = (e) => {
                    e.preventDefault();
                    column.classList.remove('drag-over');
                    
                    const value = JSON.parse(e.dataTransfer.getData('text/plain'));
                    const rank = parseInt(column.dataset.rank);
                    
                    // Remove from previous position
                    Object.keys(rankedValues).forEach(key => {
                        if (rankedValues[key] && 
                            rankedValues[key].name === value.name && 
                            Boolean(rankedValues[key].isCustom) === Boolean(value.isCustom)) {
                            rankedValues[key] = null;
                        }
                    });
                    
                    rankedValues[rank] = value;
                    updateRankingDisplay();
                    updateButtonStates();
                };
            });
        }

        // Update ranking display
        function updateRankingDisplay() {
            document.querySelectorAll('.rank-column').forEach(column => {
                const rank = parseInt(column.dataset.rank);
                const existingSorted = column.querySelector('.sorted-value');
                if (existingSorted) existingSorted.remove();
                
                if (rankedValues[rank]) {
                    const sortedCard = document.createElement('div');
                    sortedCard.className = 'sorted-value';
                    
                    if (rankedValues[rank].isCustom) sortedCard.classList.add('custom');
                    
                    sortedCard.innerHTML = `
                        <h4>${rankedValues[rank].name}${rankedValues[rank].isCustom ? ' ✨' : ''}</h4>
                        <p>${rankedValues[rank].description}</p>
                    `;
                    column.appendChild(sortedCard);
                }
            });
            
            // Hide ranked values from pool
            const pool = document.getElementById('rankingPool');
            pool.querySelectorAll('.value-card').forEach(card => {
                const cardTitle = card.querySelector('h3').textContent.replace(' ✨', '');
                const isRanked = Object.values(rankedValues).some(rv => rv && rv.name === cardTitle);
                card.style.display = isRanked ? 'none' : 'block';
            });
        }

        // Show results
        function showResults() {
            const resultsContainer = document.getElementById('topValues');
            resultsContainer.innerHTML = '';
            
            [1, 2, 3].forEach(rank => {
                const value = rankedValues[rank];
                const card = document.createElement('div');
                card.className = 'top-value';
                
                if (value.isCustom) card.classList.add('custom');
                
                card.innerHTML = `
                    <div class="value-rank">#${rank}</div>
                    <h3>${value.name}${value.isCustom ? ' ✨' : ''}</h3>
                    <p>${value.description}</p>
                    ${value.isCustom ? '<div style="color: #28a745; font-weight: bold; margin-top: 10px;">Your Custom Value</div>' : ''}
                `;
                resultsContainer.appendChild(card);
            });
            
            document.getElementById(`step${currentStep}`).classList.remove('active');
            currentStep = 5;
            document.getElementById(`step${currentStep}`).classList.add('active');
            updateProgress();
        }

        // Update progress
        function updateProgress() {
            const progress = (currentStep - 1) / 4 * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        // CLEAN PDF GENERATION - with all 6 selected values
        function generatePDF() {
            console.log('PDF Generation - Selected Values:', selectedValues.map(v => v.name));
            console.log('PDF Generation - Ranked Values:', rankedValues);
            
            if (!studentInfo.name || !rankedValues[1] || !rankedValues[2] || !rankedValues[3]) {
                showModal('⚠️ Missing Data', 'Please complete all steps before generating the PDF.');
                return;
            }

            if (selectedValues.length === 0) {
                showModal('⚠️ No Selected Values', 'No selected values found. Please retake the survey.');
                return;
            }

            // Create simple, clean HTML
            const htmlContent = createSimplePDF();
            
            // Try to open in new window
            const printWindow = window.open('', '_blank', 'width=800,height=600');
            
            if (!printWindow) {
                // Fallback: download as file
                downloadHTMLFile(htmlContent);
                showModal('📄 PDF Downloaded!', 'Your results have been downloaded. Open the HTML file in your browser and print as PDF.');
            } else {
                printWindow.document.write(htmlContent);
                printWindow.document.close();
                
                printWindow.onload = function() {
                    setTimeout(() => printWindow.print(), 1000);
                };
                
                showModal('📄 PDF Window Opened!', 'Your results opened in a new window. Use Ctrl+P to save as PDF.');
            }
        }

        // Create simple PDF HTML
        function createSimplePDF() {
            // Build top 3 section
            let topThreeHTML = '';
            for (let i = 1; i <= 3; i++) {
                const value = rankedValues[i];
                topThreeHTML += `
                    <div style="border: 3px solid #667eea; padding: 20px; margin: 20px 0; border-radius: 10px;">
                        <h3 style="color: #667eea; font-size: 24px; margin-bottom: 10px;">#${i} - ${value.name}${value.isCustom ? ' ✨' : ''}</h3>
                        <p style="color: #555; font-size: 16px;">${value.description}</p>
                        ${value.isCustom ? '<p style="color: #28a745; font-weight: bold; margin-top: 10px;">Your Personal Custom Value</p>' : ''}
                    </div>
                `;
            }

            // Build ALL 6 selected values section
            let allSixHTML = '';
            for (let i = 0; i < selectedValues.length; i++) {
                const value = selectedValues[i];
                
                // Check if ranked
                let rankText = '';
                for (let rank = 1; rank <= 3; rank++) {
                    if (rankedValues[rank] && rankedValues[rank].name === value.name && Boolean(rankedValues[rank].isCustom) === Boolean(value.isCustom)) {
                        rankText = ` (Ranked #${rank})`;
                        break;
                    }
                }

                const borderColor = value.isCustom ? '#28a745' : '#ddd';
                
                allSixHTML += `
                    <div style="border: 2px solid ${borderColor}; padding: 15px; margin: 10px 0; border-radius: 8px; background: #fafafa;">
                        <h4 style="color: #2c3e50; margin-bottom: 5px;">${value.name}${value.isCustom ? ' ✨' : ''}${rankText}</h4>
                        <p style="color: #666; font-size: 14px;">${value.description}</p>
                        ${value.isCustom ? '<p style="color: #28a745; font-weight: bold; font-size: 12px; margin-top: 5px;">Your Personal Custom Value</p>' : ''}
                    </div>
                `;
            }

            return `<!DOCTYPE html>
<html>
<head>
    <title>Values Survey Results</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; padding: 40px; line-height: 1.6; }
        h1, h2, h3 { color: #2c3e50; }
        .section { margin-bottom: 40px; }
    </style>
</head>
<body>
    <h1 style="text-align: center; color: #2c3e50;">Values Discovery Survey Results</h1>
    
    <div style="background: #f8f9ff; padding: 20px; border-radius: 10px; border: 2px solid #667eea; margin: 20px 0;">
        <strong>Name:</strong> ${studentInfo.name}<br>
        <strong>Date:</strong> ${new Date(studentInfo.date).toLocaleDateString()}
    </div>
    
    <div class="section">
        <h2>Your Top 3 Core Values (Ranked in Order of Importance)</h2>
        <p>These are your most important values - the principles that should guide your key life decisions:</p>
        ${topThreeHTML}
    </div>

    <div class="section">
        <h2 style="color: #d63384;">All Your Selected Values (${selectedValues.length} Total)</h2>
        <p><strong>These are all ${selectedValues.length} values you initially selected as important to you.</strong> This serves as a point-in-time record to help you track how your values may evolve over time:</p>
        
        <div style="background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 8px; margin: 20px 0;">
            <strong>💡 Future Reflection:</strong> When you retake this survey later, compare these results to see how your values have remained consistent or evolved as you've grown and experienced new things.
        </div>
        
        ${allSixHTML}
    </div>
    
    <div style="text-align: center; margin-top: 50px; border-top: 2px solid #eee; padding-top: 20px;">
        <p><strong>Values Discovery Survey</strong> | Generated on ${new Date().toLocaleDateString()}</p>
        <p style="font-style: italic; margin-top: 15px;">These values represent what matters most to you. Use them to guide important decisions and life choices.</p>
        <p style="font-size: 12px; margin-top: 10px;">Keep this record to compare with future assessments and track your personal growth.</p>
    </div>
</body>
</html>`;
        }

        // Download HTML file
        function downloadHTMLFile(content) {
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${studentInfo.name.replace(/\s+/g, '_')}_Values_Survey.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Reset survey
        function resetSurvey() {
            currentStep = 1;
            selectedValues = [];
            customValues = [];
            rankedValues = { 1: null, 2: null, 3: null };
            studentInfo = {};
            
            document.getElementById('studentName').value = '';
            document.getElementById('surveyDate').valueAsDate = new Date();
            document.getElementById('customValueName').value = '';
            document.getElementById('customValueDescription').value = '';
            
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.getElementById('step1').classList.add('active');
            
            displayCustomValues();
            populateValuesGrid();
            updateSelectionCounter();
            updateButtonStates();
            updateProgress();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initSurvey);
    </script>
</body>
</html>